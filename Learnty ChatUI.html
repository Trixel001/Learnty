<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Learnie AI - Chat</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@700&display=swap');

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a;
            overflow: hidden; 
            color: white;
            margin: 0;
        }

        /* Custom Animations */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(13, 148, 136, 0.3); transform: scale(1); }
            50% { box-shadow: 0 0 25px rgba(13, 148, 136, 0.6); transform: scale(1.05); }
        }
        
        @keyframes typing-bounce {
            0%, 100% { transform: translateY(0); opacity: 0.5; }
            50% { transform: translateY(-4px); opacity: 1; }
        }

        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes text-fade {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Sidebar Slide In */
        @keyframes slide-in-right {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        .animate-text-cycle {
            animation: text-fade 4s infinite;
        }

        .sidebar-enter {
            animation: slide-in-right 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .message-enter { animation: slide-up 0.3s ease-out forwards; }

        /* Scrollbar styling for chat area */
        .chat-scroll::-webkit-scrollbar { width: 4px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        /* --- SOUND ENGINE --- */
        const playSound = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            const now = ctx.currentTime;

            if (type === 'send') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'receive') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.setValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0.1, now + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
                osc.start(now);
                osc.stop(now + 0.4);
            } else if (type === 'typing') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(200, now);
                gain.gain.setValueAtTime(0.02, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } else if (type === 'mic') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
            } else if (type === 'reset') {
                // A "whoosh" sound for new chat
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(600, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        };

        /* --- ICONS --- */
        const ArrowLeftIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        );
        const SendIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="22" x2="11" y1="2" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        );
        const MicIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/><line x1="8" x2="16" y1="22" y2="22"/></svg>
        );
        const BrainIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
        );
        const ClockIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        const PlusIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        );
        const MessageSquareIcon = ({className}) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        );

        const UserAvatar = () => (
            <div className="w-8 h-8 md:w-10 md:h-10 rounded-xl bg-indigo-600 flex items-center justify-center border border-white/20 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5 text-white"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </div>
        );

        /* --- BACKGROUND --- */
        const GalaxyBackground = () => {
            const mountRef = useRef(null);
            useEffect(() => {
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x0f172a, 0.002);
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                mountRef.current.appendChild(renderer.domElement);
                
                const particlesGeometry = new THREE.BufferGeometry();
                const particlesCount = 800;
                const posArray = new Float32Array(particlesCount * 3);
                const colors = new Float32Array(particlesCount * 3);
                const colorTeal = new THREE.Color("#0d9488");
                const colorWhite = new THREE.Color("#ffffff");
                
                for(let i = 0; i < particlesCount * 3; i+=3) {
                    posArray[i] = (Math.random() - 0.5) * 15;
                    posArray[i+1] = (Math.random() - 0.5) * 15;
                    posArray[i+2] = (Math.random() - 0.5) * 15;
                    const mixedColor = Math.random() > 0.6 ? colorTeal : colorWhite;
                    colors[i] = mixedColor.r;
                    colors[i+1] = mixedColor.g;
                    colors[i+2] = mixedColor.b;
                }
                particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
                particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                const material = new THREE.PointsMaterial({ size: 0.04, vertexColors: true, transparent: true, opacity: 0.4 });
                const particlesMesh = new THREE.Points(particlesGeometry, material);
                scene.add(particlesMesh);
                camera.position.z = 5;
                
                let time = 0;
                const animate = () => {
                    requestAnimationFrame(animate);
                    time += 0.001;
                    particlesMesh.rotation.y = time * 0.5; 
                    particlesMesh.rotation.x = time * 0.2;
                    renderer.render(scene, camera);
                };
                animate();
                
                const handleResize = () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                };
                window.addEventListener('resize', handleResize);
                return () => {
                    window.removeEventListener('resize', handleResize);
                    if(mountRef.current) mountRef.current.innerHTML = '';
                };
            }, []);
            return <div ref={mountRef} className="fixed top-0 left-0 w-full h-full z-0 pointer-events-none" />;
        };

        /* --- SIDEBAR COMPONENT --- */
        const ChatSidebar = ({ isOpen, onClose, onNewChat }) => {
            if (!isOpen) return null;

            const historyItems = [
                { id: 1, title: "Quantum Physics Quiz", date: "2 mins ago" },
                { id: 2, title: "Mars Colonization", date: "Yesterday" },
                { id: 3, title: "French Basics Level 1", date: "Mon" },
                { id: 4, title: "Debugging React 101", date: "Last week" },
            ];

            return (
                <div className="fixed inset-0 z-50 flex justify-end">
                    {/* Backdrop */}
                    <div 
                        onClick={onClose}
                        className="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity"
                    ></div>
                    
                    {/* Drawer */}
                    <div className="relative w-[75%] max-w-sm h-full bg-slate-900/95 border-l border-white/10 shadow-2xl sidebar-enter flex flex-col">
                        <div className="p-6 flex items-center justify-between border-b border-white/5">
                            <h2 className="text-xl font-bold font-['Space_Grotesk'] text-white">History</h2>
                            <button onClick={onClose} className="p-2 text-slate-400 hover:text-white">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 space-y-3">
                            {historyItems.map(item => (
                                <div key={item.id} className="group p-4 rounded-2xl bg-slate-800/40 border border-white/5 hover:bg-[#0d9488]/10 hover:border-[#0d9488]/30 transition-all cursor-pointer">
                                    <div className="flex items-center gap-3 mb-1">
                                        <MessageSquareIcon className="w-4 h-4 text-[#0d9488]" />
                                        <h3 className="font-semibold text-sm text-slate-200 group-hover:text-white truncate">{item.title}</h3>
                                    </div>
                                    <span className="text-xs text-slate-500 pl-7">{item.date}</span>
                                </div>
                            ))}
                        </div>

                        <div className="p-6 border-t border-white/5 bg-slate-900/50">
                            <button 
                                onClick={() => { onNewChat(); onClose(); }}
                                className="w-full py-3.5 bg-[#0d9488] hover:bg-[#0f766e] text-white rounded-xl font-bold flex items-center justify-center gap-2 shadow-[0_0_15px_rgba(13,148,136,0.3)] active:scale-95 transition-all"
                            >
                                <PlusIcon className="w-5 h-5" />
                                Start New Chat
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        /* --- CHAT BUBBLES --- */
        const MessageBubble = ({ text, sender }) => {
            const isBot = sender === 'bot';
            return (
                <div className={`flex w-full mb-6 message-enter ${isBot ? 'justify-start' : 'justify-end'}`}>
                    {isBot && (
                        <div className="flex-shrink-0 mr-3 mt-1">
                            <div className="w-8 h-8 md:w-10 md:h-10 rounded-xl bg-[#0d9488]/20 border border-[#0d9488]/50 flex items-center justify-center shadow-[0_0_15px_#0d9488]">
                                <BrainIcon className="w-5 h-5 text-[#2dd4bf]" />
                            </div>
                        </div>
                    )}
                    <div className={`
                        relative max-w-[75%] px-5 py-3.5 rounded-2xl text-sm md:text-base leading-relaxed shadow-lg backdrop-blur-md border
                        ${isBot 
                            ? 'bg-slate-900/80 border-slate-700 text-slate-200 rounded-tl-none' 
                            : 'bg-[#0d9488]/90 border-[#2dd4bf]/30 text-white rounded-tr-none'
                        }
                    `}>
                        {text}
                    </div>
                    {!isBot && (
                        <div className="flex-shrink-0 ml-3 mt-1">
                            <UserAvatar />
                        </div>
                    )}
                </div>
            );
        };

        const TypingIndicator = () => (
            <div className="flex w-full mb-6 justify-start message-enter">
                <div className="flex-shrink-0 mr-3 mt-1">
                    <div className="w-8 h-8 md:w-10 md:h-10 rounded-xl bg-[#0d9488]/20 border border-[#0d9488]/50 flex items-center justify-center">
                        <BrainIcon className="w-5 h-5 text-[#2dd4bf] animate-pulse" />
                    </div>
                </div>
                <div className="bg-slate-900/80 border border-slate-700 px-4 py-4 rounded-2xl rounded-tl-none flex gap-1.5 items-center shadow-lg backdrop-blur-md">
                    <div className="w-2 h-2 bg-[#2dd4bf] rounded-full animate-[typing-bounce_1.4s_infinite_ease-in-out_0s]"></div>
                    <div className="w-2 h-2 bg-[#2dd4bf] rounded-full animate-[typing-bounce_1.4s_infinite_ease-in-out_0.2s]"></div>
                    <div className="w-2 h-2 bg-[#2dd4bf] rounded-full animate-[typing-bounce_1.4s_infinite_ease-in-out_0.4s]"></div>
                </div>
            </div>
        );

        /* --- MAIN APP --- */
        const ChatApp = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: "Hello! I'm Learnie. What topic should we transform into a game today?", sender: 'bot' }
            ]);
            const [input, setInput] = useState("");
            const [isTyping, setIsTyping] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [headerText, setHeaderText] = useState("Learnie");
            const messagesEndRef = useRef(null);

            // Auto-scroll
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages, isTyping]);

            // Header Text Animation Loop
            useEffect(() => {
                const interval = setInterval(() => {
                    setHeaderText(prev => prev === "Learnie" ? "New Chat" : "Learnie");
                }, 4000); // Switch every 4 seconds
                return () => clearInterval(interval);
            }, []);

            const startNewChat = () => {
                playSound('reset');
                setMessages([{ id: Date.now(), text: "System rebooted. ðŸŒŒ What's the next mission?", sender: 'bot' }]);
                setSidebarOpen(false);
            };

            const generateReply = (userText) => {
                const lower = userText.toLowerCase();
                if (lower.includes("hello") || lower.includes("hi")) return "Hey there! Ready to level up your brain?";
                if (lower.includes("game")) return "Gaming mode activated! ðŸŽ® Give me a subject, and I'll generate a quiz.";
                if (lower.includes("book")) return "I can deconstruct books into byte-sized XP. Upload one later!";
                return "Interesting! Tell me more, I'm analyzing the data... ðŸ§ ";
            };

            const handleSend = (e) => {
                e.preventDefault();
                if (!input.trim()) return;
                
                const userMsg = { id: Date.now(), text: input, sender: 'user' };
                setMessages(prev => [...prev, userMsg]);
                setInput("");
                playSound('send');

                setIsTyping(true);
                const replyText = generateReply(input);
                const delay = Math.min(Math.max(replyText.length * 20, 1000), 3000);

                setTimeout(() => playSound('typing'), delay / 2);

                setTimeout(() => {
                    setIsTyping(false);
                    setMessages(prev => [...prev, { id: Date.now() + 1, text: replyText, sender: 'bot' }]);
                    playSound('receive');
                }, delay);
            };

            return (
                <div className="relative w-full h-[100dvh] flex flex-col overflow-hidden">
                    <GalaxyBackground />

                    {/* --- SIDEBAR --- */}
                    <ChatSidebar 
                        isOpen={sidebarOpen} 
                        onClose={() => setSidebarOpen(false)} 
                        onNewChat={startNewChat}
                    />

                    {/* --- HEADER (FLOATING) --- */}
                    <header className="absolute top-0 left-0 w-full h-28 z-30 pointer-events-none flex items-start justify-between px-6 py-6 bg-gradient-to-b from-[#0f172a]/90 to-transparent">
                        
                        {/* Back Button */}
                        <button 
                            onClick={() => window.location.reload()} 
                            className="pointer-events-auto p-3 rounded-full hover:bg-white/10 transition-colors text-slate-300 hover:text-white backdrop-blur-sm border border-transparent hover:border-white/10"
                        >
                            <ArrowLeftIcon className="w-6 h-6" />
                        </button>

                        {/* Center Mascot (NEW CHAT BUTTON) */}
                        <div className="pointer-events-auto flex flex-col items-center mt-2 cursor-pointer group" onClick={startNewChat}>
                            <div className="relative">
                                <div className="absolute inset-0 bg-[#0d9488] blur-xl opacity-30 rounded-full animate-[pulse-glow_3s_infinite] group-hover:opacity-60 transition-opacity"></div>
                                <BrainIcon className="w-10 h-10 text-[#2dd4bf] relative z-10 drop-shadow-[0_0_10px_rgba(45,212,191,0.8)] transition-transform group-hover:rotate-12 group-active:scale-90" />
                            </div>
                            
                            {/* Animated Text */}
                            <div className="relative h-4 w-24 mt-2 text-center overflow-hidden">
                                <span 
                                    key={headerText} // Key forces re-render for animation
                                    className="absolute inset-0 flex items-center justify-center text-[10px] font-['Space_Grotesk'] tracking-[0.2em] text-[#2dd4bf] uppercase opacity-90 animate-[text-fade_4s_infinite]"
                                >
                                    {headerText}
                                </span>
                            </div>
                        </div>

                        {/* History Button (Right Side) */}
                        <button 
                            onClick={() => setSidebarOpen(true)}
                            className="pointer-events-auto p-3 rounded-full hover:bg-white/10 transition-colors text-slate-300 hover:text-white backdrop-blur-sm border border-transparent hover:border-white/10"
                        >
                            <ClockIcon className="w-6 h-6" />
                        </button>
                    </header>

                    {/* --- CHAT AREA --- */}
                    <main className="flex-1 overflow-y-auto p-6 pt-32 pb-4 relative z-10 chat-scroll">
                        <div className="max-w-3xl mx-auto flex flex-col justify-end min-h-full">
                            {messages.map(msg => (
                                <MessageBubble key={msg.id} text={msg.text} sender={msg.sender} />
                            ))}
                            {isTyping && <TypingIndicator />}
                            <div ref={messagesEndRef} />
                        </div>
                    </main>

                    {/* --- FOOTER --- */}
                    <footer className="flex-shrink-0 p-4 md:p-6 relative z-20 bg-slate-900/60 backdrop-blur-xl border-t border-white/5">
                        <form onSubmit={handleSend} className="max-w-3xl mx-auto relative flex items-end gap-3">
                            <button 
                                type="button"
                                onClick={() => playSound('mic')}
                                className="flex-shrink-0 w-12 h-12 rounded-2xl bg-slate-800/50 border border-slate-700 flex items-center justify-center text-slate-400 hover:text-[#0d9488] hover:border-[#0d9488]/50 hover:bg-[#0d9488]/10 transition-all active:scale-95"
                            >
                                <MicIcon className="w-6 h-6" />
                            </button>
                            <div className="flex-1 relative">
                                <input 
                                    type="text" 
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    placeholder="Ask Learnie anything..."
                                    className="w-full h-12 pl-5 pr-4 bg-slate-800/50 border border-slate-700 rounded-2xl text-white placeholder-slate-500 focus:outline-none focus:border-[#0d9488] focus:ring-1 focus:ring-[#0d9488] transition-all shadow-inner"
                                />
                            </div>
                            <button 
                                type="submit"
                                disabled={!input.trim()}
                                className={`
                                    flex-shrink-0 w-12 h-12 rounded-2xl flex items-center justify-center text-white shadow-lg transition-all active:scale-95
                                    ${input.trim() 
                                        ? 'bg-[#0d9488] hover:bg-[#0f766e] shadow-[0_0_15px_#0d9488]' 
                                        : 'bg-slate-800 border border-slate-700 text-slate-600 cursor-not-allowed'
                                    }
                                `}
                            >
                                <SendIcon className={`w-5 h-5 ${input.trim() ? 'translate-x-0.5 translate-y-0.5' : ''}`} />
                            </button>
                        </form>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChatApp />);
    </script>
</body>
</html>


